/*! build:ucf hash:71750d44a5257e89ea60, chunkhash:525af0fc55ccb81e039e, name:masterdetail-one/index, filebase:index.js, query:, file:masterdetail-one/index.js */!function(e){function t(t){for(var r,o,l=t[0],s=t[1],c=t[2],u=0,p=[];u<l.length;u++)o=l[u],n[o]&&p.push(n[o][0]),n[o]=0;for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r]);for(d&&d(t);p.length;)p.shift()();return i.push.apply(i,c||[]),a()}function a(){for(var e,t=0;t<i.length;t++){for(var a=i[t],r=!0,l=1;l<a.length;l++){var s=a[l];0!==n[s]&&(r=!1)}r&&(i.splice(t--,1),e=o(o.s=a[0]))}return e}var r={},n={2:0},i=[];function o(t){if(r[t])return r[t].exports;var a=r[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,o),a.l=!0,a.exports}o.m=e,o.c=r,o.d=function(e,t,a){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(o.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(a,r,function(t){return e[t]}.bind(null,r));return a},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="";var l=window.webpackJsonp=window.webpackJsonp||[],s=l.push.bind(l);l.push=t,l=l.slice();for(var c=0;c<l.length;c++)t(l[c]);var d=s;i.push([2065,0]),a()}({0:function(e,t){e.exports=React},1:function(e,t){e.exports=PropTypes},1662:function(e,t,a){},1940:function(e,t,a){},1943:function(e,t,a){},1944:function(e,t,a){},1945:function(e,t,a){},1946:function(e,t,a){},2065:function(e,t,a){"use strict";a.r(t);a(135);var r=a(0),n=a.n(r),i=a(2),o=a.n(i),l=a(6),s=a.n(l),c=a(16),d=a.n(c),u=a(27),p=a.n(u),m=a(10),f=a.n(m),h=a(11),b=a.n(h),D=a(12),v=a.n(D),O=a(13),g=a.n(O),y=a(14),E=a.n(y),S=a(3),w=a(50),k=a(5),x=a.n(k),_=a(49),j=a(20),C=a(51),N=a(8),I=a.n(N),P=a(24),L=a(98),M=a(4),B=(a(1662),P.a.Item),F=S.Select.Option,A=function(e){function t(e){var a;return f()(this,t),(a=v()(this,g()(t).call(this,e))).search=function(){a.props.form.validateFields(function(e,t){var r=Object(M.m)(t);if(!e){var n=a.props.orderObj.pageSize;r.pageIndex=0,r.pageSize=n,i.actions.masterDetailOne.loadList(r)}})},a.reset=function(){a.props.form.resetFields()},a.state={},a}return E()(t,e),b()(t,[{key:"render",value:function(){var e=this.props.form.getFieldProps;return n.a.createElement(L.a,{reset:this.reset,search:this.search},n.a.createElement(P.a,{size:"sm"},n.a.createElement(B,{label:"编号"},n.a.createElement(S.FormControl,I()({placeholder:"模糊查询"},e("search_orderCode",{initialValue:""})))),n.a.createElement(B,{label:"名称"},n.a.createElement(S.FormControl,I()({placeholder:"模糊查询"},e("search_orderName",{initialValue:""})))),n.a.createElement(B,{label:"类型"},n.a.createElement(S.Select,e("search_orderType",{initialValue:""}),n.a.createElement(F,{value:""},"请选择"),n.a.createElement(F,{value:"1"},"普通采购"),n.a.createElement(F,{value:"2"},"委托代销"),n.a.createElement(F,{value:"3"},"直运采购"))),n.a.createElement(B,{label:"流程状态"},n.a.createElement(S.Select,e("search_bpmState",{initialValue:""}),n.a.createElement(F,{value:""},"全部"),n.a.createElement(F,{value:0},"待确认"),n.a.createElement(F,{value:1},"执行中"),n.a.createElement(F,{value:2},"已办结"),n.a.createElement(F,{value:3},"终止")))))}}]),t}(r.Component),q=P.a.createForm()(A),T=a(81),V=a(82),R=(a(1940),"YYYY-MM-DD"),z=function(e){function t(e){var a;return f()(this,t),(a=v()(this,g()(t).call(this,e))).loadPage=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=a.props.orderObj,r=t.pageSize,n=t.pageIndex,o={pageIndex:(n||1)-1,pageSize:r};i.actions.masterDetailOne.loadList(p()({},o,e))},a.onClickAddEditView=function(e){var t=a.props,r=t.selectIndex,n=t.orderObj.list,i=null;0!==e&&(i=(void 0===n?[]:n)[r]),a.goToOrder(i,e)},a.goToOrder=function(e,t){i.actions.masterDetailOrder.setQueryParent(e),i.actions.routing.push({pathname:"order",search:"?search_id=".concat(e?e.id:"","&btnFlag=").concat(t,"&t=").concat(Math.random())})},a.freshData=function(e,t){a.onPageSelect(e,0,t)},a.onDataNumSelect=function(e,t,r){a.onPageSelect(t,1,r)},a.onPageSelect=function(e,t,r){var n=Object(M.f)(a.props.searchParam),o=a.props[r],l=Object(M.k)(e,t,o),s=l.pageIndex,c=l.pageSize;if("orderObj"===r&&(n.pageSize=c,n.pageIndex=s,i.actions.masterDetailOne.updateState({searchParam:n}),i.actions.masterDetailOne.loadList(n)),"detailObj"===r){var d=a.props,u=d.selectIndex,p={search_orderId:d.orderObj.list[u].id,pageSize:c,pageIndex:s};i.actions.masterDetailOne.loadOrderDetailList(p)}},a.onClickDel=function(){return a.setState({delModalVisible:!0})},a.export=function(){a.grid.exportExcel()},a.orderColumn=[{title:"编号",dataIndex:"orderCode",key:"orderCode",width:250,render:function(e,t,r){return n.a.createElement("span",{className:"demo-table-code",onClick:function(e){e.preventDefault(),a.goToOrder(t,2)}},e)}},{title:"名称",dataIndex:"orderName",key:"orderName",width:100},{title:"类型",dataIndex:"orderTypeEnumValue",key:"orderTypeEnumValue",width:100},{title:"价格",dataIndex:"orderPrice",key:"orderPrice",width:80,className:"column-number-right ",render:function(e,t,a){return n.a.createElement("span",null,"number"==typeof e?e.toFixed(2):"")}},{title:"申请人",dataIndex:"orderUserName",key:"orderUserName",width:200},{title:"申请部门",dataIndex:"orderDeptName",key:"orderDeptName",width:150},{title:"申请日期",dataIndex:"orderDate",key:"orderDate",width:150,render:function(e,t,a){return n.a.createElement("div",null,e?x()(e).format(R):"")}},{title:"流程状态",dataIndex:"bpmStateEnumValue",key:"bpmStateEnumValue",width:150}],a.detailColumn=[{title:"物料名称",dataIndex:"detailName",key:"detailName",width:200,fixed:"left"},{title:"物料型号",dataIndex:"detailModel",key:"detailModel",width:200},{title:"物料数量",dataIndex:"detailCount",key:"detailCount",width:200,className:"column-number-right "},{title:"需求日期",dataIndex:"detailDate",key:"detailDate",width:200,render:function(e,t,a){return n.a.createElement("div",null,e?x()(e).format(R):"")}}],a.getBasicPage=function(e){return{activePage:e.pageIndex,total:e.total,items:e.totalPages,dataNum:1}},a.bpmStart=function(e,t){return d()(s.a.mark(function r(){var n,o;return s.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if("start"!=t){r.next=5;break}return r.next=3,i.actions.masterDetailOne.updateState({showLoading:!0});case 3:r.next=9;break;case 5:n="submit"==e?"单据提交成功":"单据撤回成功",Object(M.s)(n),o=Object(M.f)(a.props.searchParam),a.loadPage(o);case 9:case"end":return r.stop()}},r)}))},a.bpmEnd=function(e,t){return function(){var e=d()(s.a.mark(function e(a){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:"error"==t&&Object(M.a)(a.msg),i.actions.masterDetailOne.updateState({showLoading:!1});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},a.dataNumMap={5:0,10:1,15:2,20:3,25:4,50:5},a.getDataNum=function(e){var t=a.dataNumMap[e];return void 0===t&&(t=6),t},a.handleBpmState=function(e,t){var a={submitForbid:!0,recallForbid:!0};if(e.length){var r=e[t].bpmState;a={submitForbid:!!r,recallForbid:1!=r}}return a},a.state={delModalVisible:!1},a}return E()(t,e),b()(t,[{key:"componentDidMount",value:function(){this.loadPage()}},{key:"confirmGoBack",value:function(){var e=d()(s.a.mark(function e(t){var a,r,n,o,l;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.props,r=a.selectIndex,n=a.orderObj,o=n.list,l=(void 0===o?[]:o)[r],this.setState({delModalVisible:!1}),1!==t){e.next=7;break}return e.next=7,i.actions.masterDetailOne.delOrder(l);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.state.delModalVisible,a=this.props,r=a.showLoading,o=a.showDetailLoading,l=a.orderObj,s=a.detailObj,c=a.selectIndex,d=l.list,u=this.handleBpmState(d,c),m=u.submitForbid,f=u.recallForbid,h=0===d.length;return n.a.createElement("div",{className:"master-detail-one"},n.a.createElement(_.a,{title:"B2 一主一子示例 "}),n.a.createElement(q,{orderObj:l}),n.a.createElement("div",{className:"table-header"},n.a.createElement(T.a,{funcCode:"masterdetail-one"},n.a.createElement(j.a,{colors:"primary",className:"ml8",role:"add",onClick:function(){return e.onClickAddEditView(0)}},"新增"),n.a.createElement(j.a,{shape:"border",className:"ml8",role:"update",disabled:m||h,onClick:function(){return e.onClickAddEditView(1)}},"修改"),n.a.createElement(j.a,{shape:"border",className:"ml8",disabled:h,onClick:function(){return e.onClickAddEditView(2)}},"详情"),n.a.createElement(j.a,{role:"delete",shape:"border",className:"ml8",disabled:m||h,onClick:this.onClickDel},"删除"),n.a.createElement(C.a,{show:t,context:"是否要删除 ?",confirmFn:function(){return e.confirmGoBack(1)},cancelFn:function(){return e.confirmGoBack(2)}}),n.a.createElement(j.a,{shape:"border",key:"export",className:"ml8",disabled:h,onClick:this.export},"导出"),n.a.createElement(V.BpmButtonSubmit,{className:"ml8",checkedArray:[l.list[c]],funccode:"masterdetail-one",nodekey:"purchaseOrder",url:"".concat("/iuap-pap-demo-be","/purchase_order/submit"),urlAssignSubmit:"".concat("/iuap-pap-demo-be","/purchase_order/assignSubmit"),onStart:this.bpmStart("submit","start"),onSuccess:this.bpmStart("submit","success"),onError:this.bpmEnd("submit","error"),onEnd:this.bpmEnd("submit","end")},n.a.createElement(j.a,{className:"ml8",size:"sm",colors:"primary",disabled:m},"提交")),n.a.createElement(V.BpmButtonRecall,{checkedArray:[l.list[c]],url:"".concat("/iuap-pap-demo-be","/purchase_order/recall"),onStart:this.bpmStart("recall","start"),onSuccess:this.bpmStart("recall","success"),onError:this.bpmEnd("recall","error"),onEnd:this.bpmEnd("recall","end")},n.a.createElement(j.a,{className:"ml8",size:"sm",colors:"primary",disabled:f},"收回")))),n.a.createElement(w.a,{ref:function(t){return e.grid=t},data:l.list,rowKey:function(e,t){return t},columns:this.orderColumn,multiSelect:!1,dragborder:!0,onRowClick:function(e,t){i.actions.masterDetailOne.updateState({selectIndex:t});var a=l.list,r=s.pageSize,n={search_orderId:a[t].id,pageSize:r,pageIndex:0};i.actions.masterDetailOne.loadOrderDetailList(n)},rowClassName:function(e,t,a){return c===t?"selected":""},paginationObj:p()({},this.getBasicPage(l),{freshData:function(t){return e.freshData(t,"orderObj")},onDataNumSelect:function(t,a){return e.onDataNumSelect(t,a,"orderObj")},dataNum:this.getDataNum(l.pageSize)})}),n.a.createElement("div",{className:"table-space"}," "),n.a.createElement("div",{className:"gird-parent"},n.a.createElement(w.a,{data:s.list,rowKey:function(e,t){return t},columns:this.detailColumn,multiSelect:!1,paginationObj:p()({},this.getBasicPage(s),{freshData:function(t){return e.freshData(t,"detailObj")},onDataNumSelect:function(t,a){return e.onDataNumSelect(t,a,"detailObj")},dataNum:this.getDataNum(s.pageSize)}),loading:{show:!r&&o}}),n.a.createElement(S.Loading,{show:r,fullScreen:!0})))}}]),t}(r.Component),Y=a(19),U={GET_LIST:"".concat("/iuap-pap-demo-be","/purchase_order/list"),GET_ORDER_DETAIL:"".concat("/iuap-pap-demo-be","/purchase_order_detail/getOrderDetail"),DEL_ORDER:"".concat("/iuap-pap-demo-be","/purchase_order/deleAssoVo"),DEL_ORDER_DETAIL:"".concat("/iuap-pap-demo-be","/purchase_order_detail/deleteBatch"),SAVE_ASSO:"".concat("/iuap-pap-demo-be","/purchase_order/saveAssoVo"),GET_USER:"".concat("/iuap-pap-demo-be","/purchase_order/listForAdd")},G=function(e){return Object(Y.a)(U.GET_LIST,{method:"get",param:e})},Q=function(e){return Object(Y.a)(U.GET_ORDER_DETAIL,{method:"get",param:e})},K={name:"masterDetailOne",initialState:{cacheData:[],tableData:[],selectData:[],status:"view",queryParams:{},selectIndex:0,showLoading:!1,showDetailLoading:!1,showModalCover:!1,orderObj:{list:[],pageIndex:1,pageSize:5,totalPages:1,total:0},detailObj:{list:[],pageIndex:1,pageSize:10,totalPages:1,total:0},searchParam:{}},reducers:{updateState:function(e,t){return p()({},e,Object(M.f)(t))}},effects:{loadList:function(){var e=d()(s.a.mark(function e(t,a){var r,n,o,l,c,d,u,p,m,f,h,b;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i.actions.masterDetailOne.updateState({showLoading:!0}),e.t0=M.p,e.next=4,G(t);case 4:e.t1=e.sent,r=(0,e.t0)(e.t1),n=r.result,o=n.data,i.actions.masterDetailOne.updateState({showLoading:!1,selectIndex:0}),l=(o||{}).content,(c=void 0===l?[]:l).length>0?(d=Object(M.r)(o,t),i.actions.masterDetailOne.updateState({orderObj:d,searchParam:t}),u=a().masterDetailOne.detailObj.pageSize,p=c[0].id,m={pageSize:u,pageIndex:0,search_orderId:p},i.actions.masterDetailOne.loadOrderDetailList(m)):(f=a().masterDetailOne,h=f.orderObj,b=f.detailObj,i.actions.masterDetailOne.updateState({orderObj:Object(M.o)(h),detailObj:Object(M.o)(b)}));case 11:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),loadOrderDetailList:function(){var e=d()(s.a.mark(function e(t,a){var r,n,o,l,c;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i.actions.masterDetailOne.updateState({showDetailLoading:!0}),e.t0=M.p,e.next=4,Q(t);case 4:e.t1=e.sent,r=(0,e.t0)(e.t1),n=r.result,i.actions.masterDetailOne.updateState({showDetailLoading:!1}),(o=n.data)?(l=Object(M.r)(o,t),i.actions.masterDetailOne.updateState({detailObj:l})):(c=a().masterDetailOne.detailObj,i.actions.masterDetailOne.updateState({detailObj:Object(M.o)(c)}));case 10:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),delOrder:function(){var e=d()(s.a.mark(function e(t,a){var r,n,o,l,c;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i.actions.masterDetailOne.updateState({showLoading:!0}),e.t0=M.p,e.next=4,s=[t],Object(Y.a)(U.DEL_ORDER,{method:"post",data:s});case 4:if(e.t1=e.sent,r=(0,e.t0)(e.t1,"删除成功"),n=r.result,i.actions.masterDetailOne.updateState({showLoading:!1}),"success"!==n.status){e.next=16;break}return o=a().masterDetailOne.orderObj,l=o.pageSize,c={pageIndex:0,pageSize:l},e.next=15,i.actions.masterDetailOne.updateState({selectIndex:0});case 15:i.actions.masterDetailOne.loadList(c);case 16:case"end":return e.stop()}var s},e)}));return function(t,a){return e.apply(this,arguments)}}()}};o.a.model(K);var H=Object(i.connect)(function(e){return e.masterDetailOne},null)(z),J=a(97),W=a.n(J),X=a(46),Z=a.n(X),$=a(35),ee=a.n($),te=a(73),ae=a.n(te),re=a(87),ne=a(45),ie=a.n(ne),oe=a(30),le=a(56),se=a.n(le),ce=(a(1943),S.Select.Option),de=P.a.Item,ue={md:4,xs:6},pe=function(e){function t(){return f()(this,t),v()(this,g()(t).apply(this,arguments))}return E()(t,e),b()(t,[{key:"render",value:function(){var e=this.props,t=e.orderRow,a=e.btnFlag,r=e.form,i=r.getFieldProps,o=r.getFieldError;return n.a.createElement(P.a,{className:"detail-body form-panel order-panel",layoutOpt:ue},n.a.createElement(de,{label:"编号",layoutOpt:ue},n.a.createElement(S.FormControl,I()({disabled:!0},i("orderCode",{initialValue:t.orderCode||""}))),n.a.createElement(oe.a,{errorMsg:o("orderCode")})),n.a.createElement(de,{required:!0,label:"名称",layoutOpt:ue},n.a.createElement(S.FormControl,I()({disabled:2===a,maxLength:20},i("orderName",{validateTrigger:"onBlur",initialValue:t.orderName||"",rules:[{required:!0,message:"请输入名称,长度小于20",max:20}]}))),n.a.createElement(oe.a,{errorMsg:o("orderName")})),n.a.createElement(de,{required:!0,label:"类型",layoutOpt:ue},n.a.createElement(S.Select,I()({disabled:2===a},i("orderType",{initialValue:t.orderType?t.orderType.toString():"1",rules:[{type:"string",required:!0}]})),n.a.createElement(ce,{value:"1"},"普通采购"),n.a.createElement(ce,{value:"2"},"委托代销"),n.a.createElement(ce,{value:"3"},"直运采购")),n.a.createElement(oe.a,{errorMsg:o("orderType")})),n.a.createElement(de,{required:!0,label:"部门",layoutOpt:ue},n.a.createElement(re.a,I()({disabled:2===a},i("orderDept",{initialValue:JSON.stringify({refname:t.orderDeptName||"",refpk:t.orderDept||""}),rules:[{message:"请选择部门",pattern:/[^({"refname":"","refpk":""}|{"refpk":"","refname":""})]/}]}),{backdrop:!1})),n.a.createElement(oe.a,{errorMsg:o("orderDept")})),n.a.createElement(de,{required:!0,label:"价格",layoutOpt:ue},n.a.createElement(se.a,I()({iconStyle:"one",precision:2,min:0,max:999999,className:"inputNumItem",disabled:2===a},i("orderPrice",{initialValue:t.orderPrice?Number(t.orderPrice):0})))),n.a.createElement(de,{label:"申请人",layoutOpt:ue},n.a.createElement(S.FormControl,I()({disabled:!0},i("createUserName",{initialValue:t.orderUserName?t.orderUserName:decodeURIComponent(Object(M.i)("_A_P_userName"))})))),n.a.createElement(de,{required:!0,label:"申请日期",layoutOpt:ue},n.a.createElement(ie.a,I()({className:"form-item",disabled:2===a,format:"YYYY-MM-DD"},i("orderDate",{initialValue:t.orderDate?x()(t.orderDate):x()(),validateTrigger:"onBlur",rules:[{required:!0,message:"请选择申请日期"}]}))),n.a.createElement(oe.a,{errorMsg:o("orderDate")})))}}]),t}(r.Component),me=a(158),fe=a(120),he=a(217),be=function(e){function t(){var e,a;f()(this,t);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(a=v()(this,(e=g()(t)).call.apply(e,[this].concat(i)))).renderComp=function(){var e=a.props,t=e.type,r=e.value,i=e.record;switch(t){case"detailName":case"detailModel":return n.a.createElement("div",null,i._edit?n.a.createElement(me.a,I()({},a.props,{status:i._status,validate:i._validate})):n.a.createElement("div",null,r));case"detailCount":return n.a.createElement("div",null,i._edit?n.a.createElement(fe.a,I()({},a.props,{status:i._status,validate:i._validate,iconStyle:"one",max:99999,min:0,step:1})):n.a.createElement("div",null,r));case"detailDate":return n.a.createElement("div",null,i._edit?n.a.createElement(he.a,I()({},a.props,{status:i._status,validate:i._validate})):n.a.createElement("div",null,r?x()(r).format("YYYY-MM-DD"):""));default:return n.a.createElement("div",null,"组件类型错误")}},a}return E()(t,e),b()(t,[{key:"render",value:function(){return n.a.createElement("div",null,this.renderComp())}}]),t}(r.Component),De=(a(1944),["新增","修改","详情"]),ve=function(e){function t(e){var a;f()(this,t),(a=v()(this,g()(t).call(this,e))).oldData=[],a.changeAllData=function(e,t,r){console.log(e+" --- ",t),a.oldData[r][e]=t},a.detailColumn=[{title:"物料名称",dataIndex:"detailName",key:"detailName",width:200,render:function(e,t,r){return n.a.createElement(be,{type:"detailName",value:e,field:"detailName",index:r,required:!0,record:t,onChange:a.changeAllData})}},{title:"物料型号",dataIndex:"detailModel",key:"detailModel",width:200,render:function(e,t,r){return n.a.createElement(be,{type:"detailModel",value:e,field:"detailModel",index:r,required:!0,record:t,onChange:a.changeAllData})}},{title:"物料数量",dataIndex:"detailCount",key:"detailCount",width:200,className:"column-number-right ",render:function(e,t,r){return n.a.createElement(be,{type:"detailCount",value:e,field:"detailCount",index:r,required:!0,record:t,onChange:a.changeAllData})}},{title:"需求日期",dataIndex:"detailDate",key:"detailDate",width:200,render:function(e,t,r){return n.a.createElement(be,{type:"detailDate",value:e,field:"detailDate",index:r,required:!0,record:t,onChange:a.changeAllData})}}],a.handlerNew=function(){var e=a.oldData,t=Object(M.f)(a.props.queryDetailObj),r=t.list;0===e.length&&(e=r);var n={key:Object(M.t)(),_edit:!0,_isNew:!0,_checked:!1,detailName:"",detailModel:"",detailCount:1,detailDate:x()(),_detailNameValidate:!1,_detailModelValidate:!1,_detailCountValidate:!0,_detailDateValidate:!0};e.unshift(n);for(var o=0;o<e.length;o++){var l=e[o];l._isNew||(l._checked=!1,l._status="new")}a.oldData=Object(M.f)(e),t.list=Object(M.f)(e),a.setState({selectData:[]}),i.actions.masterDetailOrder.updateState({queryDetailObj:t,status:"new",rowEditStatus:!1})},a.onClickUpdate=function(){var e=a.oldData,t=Object(M.f)(a.props.queryDetailObj),r=Object(M.f)(t).list;for(var n in 0===e.length&&(e=r),e){var o=e[n];o._checked=!1,o._status="edit",o._edit=!0,o._disable=!0}a.oldData=Object(M.f)(e),t.list=e,a.setState({selectData:[]}),i.actions.masterDetailOrder.updateState({queryDetailObj:Object(M.f)(t),status:"edit",rowEditStatus:!1})},a.onClickDel=function(){0===a.state.selectData.length?Object(M.b)("请勾选数据后再删除"):a.setState({showPopAlert:!0})},a.clearOldData=function(){var e=Object(M.f)(a.props.queryDetailObj),t=e.list;a.asyncOldDataOrList(t);var r=a.state.selectData,n=!0,o=!1,l=void 0;try{for(var s,c=r[Symbol.iterator]();!(n=(s=c.next()).done);n=!0){var d=s.value,u=!0,p=!1,m=void 0;try{for(var f,h=t.entries()[Symbol.iterator]();!(u=(f=h.next()).done);u=!0){var b=Z()(f.value,2),D=b[0],v=b[1];if(d.id&&v.id===d.id)return!0;d.key&&v.key===d.key&&t.splice(D,1)}}catch(e){p=!0,m=e}finally{try{u||null==h.return||h.return()}finally{if(p)throw m}}}}catch(e){o=!0,l=e}finally{try{n||null==c.return||c.return()}finally{if(o)throw l}}return a.oldData=t,e.list=t,a.setState({selectData:[]}),i.actions.masterDetailOrder.updateState({queryDetailObj:e}),!1},a.asyncOldDataOrList=function(e){e.forEach(function(t,r){t.key===a.oldData[r].key&&(e[r]=a.oldData[r])})},a.onBack=d()(s.a.mark(function e(){var t,r;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(2!==a.state.btnFlag){e.next=13;break}t=ae.a.parse(a.props.location.search),r=t.from,e.t0=r,e.next=void 0===e.t0?7:10;break;case 7:return a.clearQuery(),i.actions.routing.replace({pathname:"/"}),e.abrupt("break",11);case 10:window.history.go(-1);case 11:e.next=14;break;case 13:a.setState({showPopBackVisible:!0});case 14:case"end":return e.stop()}},e)})),a.filterDataParam=function(e){var t=!0,a=!1,r=void 0;try{for(var n,i=e.entries()[Symbol.iterator]();!(t=(n=i.next()).done);t=!0){var o=Z()(n.value,2),l=o[0],s=o[1],c=s.detailDate,d=void 0===c?x()():c;s.detailDate=x()(d).format("YYYY-MM-DD"),e[l]=s}}catch(e){a=!0,r=e}finally{try{t||null==i.return||i.return()}finally{if(a)throw r}}return e},a.validateChild=function(e){return e.forEach(function(e){a.validateKeys.forEach(function(t){""!==e[t]?e["_".concat(t,"Validate")]=!0:e["_".concat(t,"Validate")]=!1})}),e},a.filterListKey=function(e){var t=a.validateChild(e),r=!0,n=!0,i=!1,o=void 0;try{for(var l,s=t.entries()[Symbol.iterator]();!(n=(l=s.next()).done);n=!0){var c=Z()(l.value,2),d=c[0],u=c[1];for(var p in u)if(t[d]._validate=!1,p.includes("Validate")&&!u[p]){t[d]._validate=!0,r=!1;break}}}catch(e){i=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}return{rowData:t,flag:r}},a.filterOrder=function(e){if(1===Number(a.state.btnFlag)){var t=a.props.queryParent;t&&t.id&&(e.id=t.id,e.ts=t.ts)}var r=e.orderDept,n=e.orderDate;if(e.orderDate=n.format("YYYY-MM-DD"),r){var i=JSON.parse(r).refpk;e.orderDept=i}return e},a.onClickSave=function(){var e=Object(M.f)(a.props.queryDetailObj),t=a.props,r=t.form,n=(t.status,{}),o=!1;r.validateFields(function(e,t){var r=Object(M.m)(t);e||((n=a.filterOrder(r)).orderUser=decodeURIComponent(Object(M.i)("_A_P_userId")),o=!0)});var l=a.filterListKey(a.oldData),s=l.rowData,c=l.flag;if(e.list=s,i.actions.masterDetailOrder.updateState({queryDetailObj:Object(M.f)(e)}),c&&o){var d=a.filterDataParam(s),u={entity:n,sublist:{purchaseOrderDetailList:d}};1===a.state.btnFlag?i.actions.masterDetailOrder.updateAsso(u).then(function(e){e&&a.clearQuery()}):0===a.state.btnFlag&&i.actions.masterDetailOrder.adds(u).then(function(e){e&&a.clearQuery()})}},a.freshData=function(e){a.onPageSelect(e,0)},a.onDataNumSelect=function(e,t){a.onPageSelect(t,1)},a.onPageSelect=function(e,t){var r=a.props,n=r.queryDetailObj,o=r.queryParent,l=Object(M.k)(e,t,n),s=l.pageIndex,c=l.pageSize,d={search_orderId:o.id,pageSize:c,pageIndex:s};i.actions.masterDetailOrder.queryChild(d)},a.getSelectedDataFunc=function(e,t,r){a.setState({selectData:e});var n=a.props.queryDetailObj,o=Object(M.f)(n.list);null!=r?o[r]._checked=!o[r]._checked:e.length>0?o.map(function(e){e._disabled||(e._checked=!0)}):o.map(function(e){e._disabled||(e._checked=!1)}),n.list=o,i.actions.masterDetailOrder.updateState({queryDetailObj:n})},a.showBpmComponent=function(e,t,r,i,o){var l=ee()(a);if(2==e&&o&&o.id)return n.a.createElement("div",null,1==t&&n.a.createElement(V.BpmTaskApprovalWrap,{id:o.id,onBpmFlowClick:function(){a.onClickToBPM(o)},appType:t,onStart:l.onBpmStart("start"),onSuccess:l.onBpmStart("success"),onError:l.onBpmEnd("error"),onEnd:l.onBpmEnd("end")}),2==t&&n.a.createElement(V.BpmTaskApprovalWrap,{id:a.state.id,processDefinitionId:r,processInstanceId:i,onBpmFlowClick:function(){l.onClickToBPM(o)},appType:t,onStart:l.onBpmStart("start"),onSuccess:l.onBpmStart("success"),onError:l.onBpmEnd("error"),onEnd:l.onBpmEnd("end")}))},a.onBpmStart=function(e){return d()(s.a.mark(function t(){return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("start"!=e){t.next=5;break}return t.next=3,i.actions.masterDetailOrder.updateState({showLoading:!0});case 3:t.next=8;break;case 5:return t.next=7,i.actions.masterDetailOrder.updateState({showLoading:!1});case 7:a.onBack();case 8:case"end":return t.stop()}},t)}))},a.onBpmEnd=function(e){return function(){var t=d()(s.a.mark(function t(a){return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:"error"==e&&Error(a.msg),i.actions.masterDetailOrder.updateState({showLoading:!1});case 2:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()},a.onClickToBPM=function(e){ae.a.parse(a.props.location.search).from;i.actions.routing.push({pathname:"/bpm-chart",search:"?id=".concat(e.id)})};var r=ae.a.parse(e.location.search),o=r.btnFlag,l=r.search_id,c=(r.from,W()(r,["btnFlag","search_id","from"])),u=Number(o);return a.state=p()({showPopAlert:!1,showPopBackVisible:!1,searchId:l||"",btnFlag:u,selectData:[]},c),a.validateKeys=["detailCount","detailDate","detailModel","detailName"],a}return E()(t,e),b()(t,[{key:"componentDidMount",value:function(){var e=ae.a.parse(this.props.location.search),t=e.btnFlag,a=e.search_id,r=e.from;if(!this.props.queryParent.id&&t>0){var n=Number(t);if(this.setState({btnFlag:n,searchId:a}),n&&n>0){var o={search_id:a,search_from:r};i.actions.masterDetailOrder.getQueryParent(o)}}}},{key:"componentWillUnmount",value:function(){"POP"===this.props.history.action&&i.actions.masterDetailOrder.initState()}},{key:"clearQuery",value:function(){this.props.form.resetFields(),i.actions.masterDetailOrder.initState({queryParent:{},queryDetailObj:{list:[],total:0,pageIndex:0}})}},{key:"confirmDel",value:function(){var e=d()(s.a.mark(function e(t){var a,r,n,o;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.setState({showPopAlert:!1}),1!==t){e.next=9;break}if(a=this.state,r=a.selectData,n=a.searchId,!this.clearOldData()){e.next=9;break}return e.next=6,i.actions.masterDetailOrder.delOrderDetail(r);case 6:o=e.sent,"success"===o.status&&(i.actions.masterDetailOrder.queryChild({search_orderId:n}),this.oldData=[]);case 9:this.setState({showPopAlert:!1});case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"confirmGoBack",value:function(){var e=d()(s.a.mark(function e(t){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.setState({showPopBackVisible:!1}),1===t&&(this.clearQuery(),i.actions.routing.replace({pathname:"/"}));case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"closeModal",value:function(){i.actions.masterDetailOrder.updateState({showModalCover:!1}),i.actions.routing.goBack()}},{key:"render",value:function(){var e=this,t=this.props,a=t.queryDetailObj,r=t.status,i=t.showLoading,o=t.form,l=t.queryParent,s=t.showDetailLoading,c=t.showModalCover,d=this.state,u=d.showPopAlert,p=d.showPopBackVisible,m=d.btnFlag,f=d.appType,h=d.processDefinitionId,b=d.processInstanceId;if(!l.id&&m>0)return null;var D={activePage:a.pageIndex,total:a.total,items:a.totalPages,freshData:this.freshData,onDataNumSelect:this.onDataNumSelect,dataNum:1,disabled:"view"!==r},v=2===m,O=0===a.list.length;return n.a.createElement("div",{className:"purchase-order"},n.a.createElement(S.Loading,{showBackDrop:!0,show:i,fullScreen:!0}),n.a.createElement(C.a,{show:p,context:"数据未保存，确定离开 ?",confirmFn:function(){e.confirmGoBack(1)},cancelFn:function(){e.confirmGoBack(2)}}),n.a.createElement(_.a,{backFn:this.onBack,back:!0,title:De[2]},n.a.createElement("div",{className:"head-btn"},n.a.createElement(j.a,{shape:"border",className:"ml8",onClick:this.onBack},"取消"),2!==m&&n.a.createElement(j.a,{colors:"primary",className:"ml8",onClick:this.onClickSave},"保存"))),this.showBpmComponent(m,f||"1",h,b,l),n.a.createElement(pe,{orderRow:l,btnFlag:m,form:o}),n.a.createElement("div",{className:"table-header"},n.a.createElement(j.a,{disabled:2===m,className:"ml8",size:"sm",colors:"primary",onClick:this.handlerNew},"新增"),n.a.createElement(j.a,{shape:"border",disabled:2===m||O,className:"ml8",size:"sm",onClick:this.onClickUpdate},"修改"),n.a.createElement(j.a,{shape:"border",disabled:2===m||O,className:"ml8",size:"sm",onClick:this.onClickDel},"删除"),n.a.createElement(C.a,{show:u,context:"新增、修改数据未保存将无法生效，确定删除这些记录吗 ?",confirmFn:function(){e.confirmDel(1)},cancelFn:function(){e.confirmDel(2)}})),n.a.createElement("div",{className:"grid-parent"},n.a.createElement(w.a,{ref:function(t){return e.grid=t},data:a.list,rowKey:function(e,t){return e.id?e.id:e.key},columns:this.detailColumn,paginationObj:D,columnFilterAble:v,showHeaderMenu:v,dragborder:v,draggable:v,syncHover:v,getSelectedDataFunc:this.getSelectedDataFunc,loading:{show:!i&&s}})),n.a.createElement(S.Modal,{show:c,onHide:this.close},n.a.createElement(S.Modal.Header,null,n.a.createElement(S.Modal.Title,null,"警告")),n.a.createElement(S.Modal.Body,null,"未获取到单据信息"),n.a.createElement(S.Modal.Footer,null,n.a.createElement(j.a,{onClick:this.closeModal},"是"))))}}]),t}(r.Component),Oe=P.a.createForm()(ve),ge={DEL_ORDER_DETAIL:"".concat("/iuap-pap-demo-be","/purchase_order_detail/deleteBatch"),SAVE_ASSO:"".concat("/iuap-pap-demo-be","/purchase_order/saveAssoVo"),UPDATE_ASSO:"".concat("/iuap-pap-demo-be","/purchase_order/updateAssoVo"),GET_USER:"".concat("/iuap-pap-demo-be","/purchase_order/listForAdd")},ye={GET_ORDER_DETAIL:"".concat("/iuap-pap-demo-be","/purchase_order_detail/getOrderDetail")},Ee=function(e){return Object(Y.a)(ye.GET_ORDER_DETAIL,{method:"get",param:e})},Se={status:"view",showLoading:!1,showDetailLoading:!1,showModalCover:!1,searchParam:{},queryParent:{},queryDetailObj:{list:[],pageIndex:1,pageSize:10,totalPages:1,total:0}},we={name:"masterDetailOrder",initialState:Se,reducers:{updateState:function(e,t){return p()({},e,Object(M.f)(t))},initState:function(e,t){if(t){var a=Object(M.f)(t);return p()({},e,a)}return Se}},effects:{setQueryParent:function(e){if(e){i.actions.masterDetailOrder.updateState({queryParent:e});var t={pageSize:10,pageIndex:0,search_orderId:e.id};i.actions.masterDetailOrder.queryChild(t)}},getQueryParent:function(){var e=d()(s.a.mark(function e(t,a){var r,n,o,l,c,d,u,p,m;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i.actions.masterDetailOrder.updateState({showLoading:!0}),e.t0=M.p,e.next=4,G(t);case 4:e.t1=e.sent,r=(0,e.t0)(e.t1),n=r.result,i.actions.masterDetailOrder.updateState({showLoading:!1}),o=n.data,n.status,l=(o||{}).content,d=(c=void 0===l?[]:l)[0]?c[0]:{},i.actions.masterDetailOrder.updateState({queryParent:d}),c.length>0?(u=t.search_id,p={pageSize:10,pageIndex:0,search_orderId:u},i.actions.masterDetailOrder.queryChild(p)):(m=a().masterDetailOrder.queryDetailObj,i.actions.masterDetailOne.updateState({queryDetailObj:Object(M.o)(m),showModalCover:!0}));case 13:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),queryChild:function(){var e=d()(s.a.mark(function e(t,a){var r,n,o,l,c;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i.actions.masterDetailOrder.updateState({showDetailLoading:!0}),e.t0=M.p,e.next=4,Ee(t);case 4:e.t1=e.sent,r=(0,e.t0)(e.t1),n=r.result,i.actions.masterDetailOrder.updateState({showDetailLoading:!1}),(o=n.data)?(l=Object(M.r)(o,t),i.actions.masterDetailOrder.updateState({queryDetailObj:l})):(c=a().masterDetailOrder.queryDetailObj,i.actions.masterDetailOrder.updateState({queryDetailObj:Object(M.o)(c)}));case 10:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),adds:function(){var e=d()(s.a.mark(function e(t,a){var r,n,o;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i.actions.masterDetailOrder.updateState({showLoading:!0}),e.t0=M.p,e.next=4,a=t,Object(Y.a)(ge.SAVE_ASSO,{method:"post",data:a});case 4:return e.t1=e.sent,r=(0,e.t0)(e.t1,"保存成功"),n=r.result,o=n?n.data:null,i.actions.masterDetailOrder.updateState({showLoading:!1,status:"view"}),o&&i.actions.routing.push({pathname:"/"}),e.abrupt("return",n);case 11:case"end":return e.stop()}var a},e)}));return function(t,a){return e.apply(this,arguments)}}(),updateAsso:function(){var e=d()(s.a.mark(function e(t,a){var r,n,o;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i.actions.masterDetailOrder.updateState({showLoading:!0}),e.t0=M.p,e.next=4,a=t,Object(Y.a)(ge.UPDATE_ASSO,{method:"post",data:a});case 4:return e.t1=e.sent,r=(0,e.t0)(e.t1,"修改成功"),n=r.result,o=n?n.data:null,i.actions.masterDetailOrder.updateState({showLoading:!1,status:"view"}),o&&i.actions.routing.push({pathname:"/"}),e.abrupt("return",n);case 11:case"end":return e.stop()}var a},e)}));return function(t,a){return e.apply(this,arguments)}}(),delOrderDetail:function(){var e=d()(s.a.mark(function e(t,a){var r,n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i.actions.masterDetailOrder.updateState({showLoading:!0}),e.t0=M.p,e.next=4,a=t,Object(Y.a)(ge.DEL_ORDER_DETAIL,{method:"post",data:a});case 4:return e.t1=e.sent,r=(0,e.t0)(e.t1,"删除成功"),n=r.result,i.actions.masterDetailOrder.updateState({showLoading:!1}),e.abrupt("return",n);case 9:case"end":return e.stop()}var a},e)}));return function(t,a){return e.apply(this,arguments)}}()}};o.a.model(we);var ke=Object(i.connect)(function(e){return e.masterDetailOrder},null)(Oe),xe=(a(1945),function(e){function t(e){var a;return f()(this,t),(a=v()(this,g()(t).call(this,e))).onBack=function(){i.actions.routing.goBack()},a.state={},a}return E()(t,e),b()(t,[{key:"render",value:function(){var e=ae.a.parse(this.props.location.search),t=e.id,a=e.processDefinitionId,r=e.processInstanceId;return n.a.createElement("div",{className:"bpm-chart"},n.a.createElement(_.a,{title:"流程图",back:!0}),n.a.createElement(V.BpmWrap,{id:t,processDefinitionId:a,processInstanceId:r}))}}]),t}(r.Component)),_e=Object(i.connect)(function(e){return e.masterDetailOne},null)(xe);a(1946);o.a.defaults({historyMode:"hash",middlewares:[]}),Object(i.render)(n.a.createElement(i.Router,null,n.a.createElement(function(){return n.a.createElement("div",{className:"route-content"},n.a.createElement(i.Route,{exact:!0,path:"/",component:H}),n.a.createElement(i.Route,{path:"/order",component:ke}),n.a.createElement(i.Route,{path:"/bpm-chart",component:_e}))},null)),document.querySelector("#app"))},3:function(e,t){e.exports=TinperBee},7:function(e,t){e.exports=ReactDOM}});